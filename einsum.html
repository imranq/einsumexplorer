<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Einsum Explorer</title>
    <script src="https://unpkg.com/@tailwindcss/browser@4"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=JetBrains+Mono:wght@400;500&display=swap"
        rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@latest"></script>
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f8fafc;
        }

        .monospace {
            font-family: 'JetBrains Mono', monospace;
        }

        .matrix-display {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            padding: 0.5rem;
            border: 1px solid #e5e7eb;
            border-radius: 0.375rem;
            background-color: #f9fafb;
            margin: 0.25rem;
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.875rem;
            line-height: 1.25rem;
            color: #374151;
            box-shadow: 0 1px 2px rgba(0, 0, 0, 0.05);
            min-width: 2.5rem;
            min-height: 2.5rem;
            text-align: center;
            transition: all 0.2s ease;
        }

        .matrix-display:hover {
            background-color: #f3f4f6;
            transform: scale(1.05);
        }

        .tensor-container {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 1rem;
            margin: 1rem 0;
        }

        .tensor-row {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
        }

        .feedback-message {
            padding: 1rem;
            margin-bottom: 1rem;
            border-radius: 0.5rem;
            animation: fadeIn 0.5s ease-in-out;
        }

        .correct-answer {
            background-color: #ecfdf5;
            color: #065f46;
            border: 1px solid #a7f3d0;
        }

        .wrong-answer {
            background-color: #fef2f2;
            color: #991b1b;
            border: 1px solid #fecaca;
        }

        .game-explanation {
            background-color: #eff6ff;
            color: #1e40af;
            border: 1px solid #bfdbfe;
            border-radius: 0.5rem;
            padding: 1rem;
            margin-top: 1rem;
        }

        .progress-bar {
            height: 0.5rem;
            background-color: #e5e7eb;
            border-radius: 9999px;
            overflow: hidden;
            margin-bottom: 1.5rem;
        }

        .progress-fill {
            height: 100%;
            background-color: #3b82f6;
            transition: width 0.3s ease;
        }

        .hint-text {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.3s ease;
        }

        .hint-text.show {
            max-height: 500px;
        }

        .cheatsheet-content {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.5s ease;
        }

        .cheatsheet-content.show {
            max-height: 2000px;
        }

        .btn {
            transition: all 0.2s ease;
            transform: translateY(0);
        }

        .btn:active {
            transform: translateY(2px);
        }

        .btn:disabled {
            cursor: not-allowed;
            opacity: 0.7;
        }

        .difficulty-badge {
            display: inline-block;
            padding: 0.25rem 0.75rem;
            border-radius: 9999px;
            font-size: 0.75rem;
            font-weight: 500;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        .difficulty-easy {
            background-color: #d1fae5;
            color: #065f46;
        }

        .difficulty-medium {
            background-color: #fef3c7;
            color: #92400e;
        }

        .difficulty-hard {
            background-color: #fee2e2;
            color: #991b1b;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(-10px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes pulse {
            0% {
                box-shadow: 0 0 0 0 rgba(59, 130, 246, 0.5);
            }

            70% {
                box-shadow: 0 0 0 10px rgba(59, 130, 246, 0);
            }

            100% {
                box-shadow: 0 0 0 0 rgba(59, 130, 246, 0);
            }
        }

        .pulse {
            animation: pulse 2s infinite;
        }

        /* Dark mode toggle */
        .dark-mode {
            background-color: #1e293b;
            color: #f1f5f9;
        }

        .dark-mode .matrix-display {
            background-color: #334155;
            border-color: #475569;
            color: #f1f5f9;
        }

        .dark-mode .matrix-display:hover {
            background-color: #475569;
        }

        .dark-mode .game-container {
            background-color: #0f172a;
        }

        .dark-mode .progress-bar {
            background-color: #334155;
        }

        .dark-mode .game-explanation {
            background-color: #1e3a8a;
            color: #bfdbfe;
            border-color: #3b82f6;
        }

        /* Responsive design */
        @media (max-width: 640px) {
            .game-container {
                padding: 1rem;
            }

            .matrix-display {
                min-width: 2rem;
                min-height: 2rem;
                padding: 0.25rem;
                font-size: 0.75rem;
            }
        }
    </style>
</head>

<body class="min-h-screen">
    <div class="container mx-auto p-4 md:p-8 max-w-4xl">
        <header class="flex flex-col md:flex-row justify-between items-center mb-8">
            <div>
                <h1 class="text-3xl md:text-4xl font-bold text-blue-600 mb-2">Einsum Explorer</h1>
                <p class="text-gray-600 dark:text-gray-300">Master Einstein Summation Notation through interactive
                    challenges</p>
            </div>
            <div class="flex items-center mt-4 md:mt-0">
                <button id="dark-mode-toggle" style="display: none;">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
                        <path d="M17.293 13.293A8 8 0 016.707 2.707a8.001 8.001 0 1010.586 10.586z" />
                    </svg>
                </button>
                <div class="relative">
                    <button id="cheatsheet-toggle"
                        class="flex items-center bg-blue-100 dark:bg-blue-900 text-blue-800 dark:text-blue-200 px-4 py-2 rounded-lg font-medium">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2" viewBox="0 0 20 20"
                            fill="currentColor">
                            <path
                                d="M9 4.804A7.968 7.968 0 005.5 4c-1.255 0-2.443.29-3.5.804v10A7.969 7.969 0 015.5 14c1.669 0 3.218.51 4.5 1.385A7.962 7.962 0 0114.5 14c1.255 0 2.443.29 3.5.804v-10A7.968 7.968 0 0014.5 4c-1.255 0-2.443.29-3.5.804V12a1 1 0 11-2 0V4.804z" />
                        </svg>
                        Einsum Cheatsheet
                    </button>
                </div>
            </div>
        </header>

        <div id="cheatsheet" class="cheatsheet-content mb-6 bg-white dark:bg-gray-800 rounded-xl shadow-md p-6">
            <h2 class="text-xl font-semibold mb-4 text-gray-800 dark:text-gray-200">Einsum Notation Cheatsheet</h2>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                <div class="bg-gray-50 dark:bg-gray-700 p-4 rounded-lg">
                    <h3 class="font-medium text-gray-800 dark:text-gray-200 mb-2">Basic Operations</h3>
                    <ul class="space-y-2 text-sm">
                        <li><code class="monospace bg-gray-200 dark:bg-gray-600 px-2 py-1 rounded">ij-></code>: Sum all
                            elements in a matrix</li>
                        <li><code class="monospace bg-gray-200 dark:bg-gray-600 px-2 py-1 rounded">ii-></code>: Trace of
                            a matrix (sum of diagonal elements)</li>
                        <li><code class="monospace bg-gray-200 dark:bg-gray-600 px-2 py-1 rounded">ij->ji</code>:
                            Transpose a matrix</li>
                        <li><code class="monospace bg-gray-200 dark:bg-gray-600 px-2 py-1 rounded">i,i-></code>: Dot
                            product of two vectors</li>
                        <li><code class="monospace bg-gray-200 dark:bg-gray-600 px-2 py-1 rounded">i,j->ij</code>: Outer
                            product of two vectors</li>
                    </ul>
                </div>
                <div class="bg-gray-50 dark:bg-gray-700 p-4 rounded-lg">
                    <h3 class="font-medium text-gray-800 dark:text-gray-200 mb-2">Matrix Operations</h3>
                    <ul class="space-y-2 text-sm">
                        <li><code class="monospace bg-gray-200 dark:bg-gray-600 px-2 py-1 rounded">ij,jk->ik</code>:
                            Matrix multiplication</li>
                        <li><code class="monospace bg-gray-200 dark:bg-gray-600 px-2 py-1 rounded">ij,j->i</code>:
                            Matrix-vector multiplication</li>
                        <li><code class="monospace bg-gray-200 dark:bg-gray-600 px-2 py-1 rounded">ijk->ik</code>: Sum
                            along the j axis</li>
                        <li><code class="monospace bg-gray-200 dark:bg-gray-600 px-2 py-1 rounded">ii->i</code>: Extract
                            diagonal elements</li>
                        <li><code class="monospace bg-gray-200 dark:bg-gray-600 px-2 py-1 rounded">ijk,ikl->ijl</code>:
                            Batch matrix multiplication</li>
                    </ul>
                </div>
            </div>
            <div class="mt-4 text-sm text-gray-600 dark:text-gray-400">
                <p>In einsum notation, repeated indices are summed over. Indices that appear in the output are kept,
                    while those that don't appear are reduced.</p>
            </div>
        </div>

        <div class="game-container bg-white dark:bg-gray-800 rounded-xl shadow-lg p-6 mb-8">
            <div class="flex justify-between items-center mb-4">
                <div class="flex items-center">
                    <span id="question-counter" class="text-lg font-semibold text-gray-700 dark:text-gray-300"></span>
                    <span id="difficulty-badge" class="ml-3 difficulty-badge"></span>
                </div>
                <div class="flex items-center">
                    <span id="score-display" class="text-lg font-semibold text-blue-600 dark:text-blue-400"></span>
                </div>
            </div>

            <div class="progress-bar">
                <div id="progress-fill" class="progress-fill"></div>
            </div>

            <div id="game-content" class="space-y-6">
                <!-- Game content will be inserted here -->
            </div>

            <div id="feedback" class="mt-6">
                <!-- Feedback will be inserted here -->
            </div>

            <div class="mt-6 flex flex-wrap justify-between items-center gap-4">
                <div>
                    <button id="hint-button"
                        class="btn bg-yellow-100 hover:bg-yellow-200 text-yellow-800 dark:bg-yellow-900 dark:hover:bg-yellow-800 dark:text-yellow-200 font-medium py-2 px-4 rounded-lg flex items-center">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2" viewBox="0 0 20 20"
                            fill="currentColor">
                            <path fill-rule="evenodd"
                                d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2h-1V9a1 1 0 00-1-1z"
                                clip-rule="evenodd" />
                        </svg>
                        Show Hint
                    </button>
                    <div id="hint-text"
                        class="hint-text mt-2 p-3 bg-yellow-50 dark:bg-yellow-900/50 text-yellow-800 dark:text-yellow-200 rounded-lg text-sm">
                    </div>
                </div>
                <button id="next-question"
                    class="btn bg-green-600 hover:bg-green-700 text-white font-medium py-2 px-6 rounded-lg flex items-center">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2" viewBox="0 0 20 20"
                        fill="currentColor">
                        <path fill-rule="evenodd"
                            d="M10.293 5.293a1 1 0 011.414 0l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414-1.414L12.586 11H5a1 1 0 110-2h7.586l-2.293-2.293a1 1 0 010-1.414z"
                            clip-rule="evenodd" />
                    </svg>
                    Next Question
                </button>
            </div>
        </div>

        <div class="bg-white dark:bg-gray-800 rounded-xl shadow-md p-6">
            <h2 class="text-xl font-semibold mb-4 text-gray-800 dark:text-gray-200">About Einsum Explorer</h2>
            <p class="text-gray-600 dark:text-gray-400 mb-4">
                Einsum Explorer is an interactive learning tool designed to help you master Einstein Summation Notation,
                a powerful mathematical notation used in tensor operations. This notation is widely used in machine
                learning,
                physics, and scientific computing.
            </p>
            <p class="text-gray-600 dark:text-gray-400">
                Practice with various tensor operations, from simple vector dot products to complex tensor contractions.
                Each question provides immediate feedback and explanations to deepen your understanding.
            </p>
        </div>
    </div>

    <script>
        // DOM Elements
        const gameContent = document.getElementById('game-content');
        const feedback = document.getElementById('feedback');
        const nextQuestionButton = document.getElementById('next-question');
        const hintButton = document.getElementById('hint-button');
        const hintText = document.getElementById('hint-text');
        const questionCounter = document.getElementById('question-counter');
        const scoreDisplay = document.getElementById('score-display');
        const progressFill = document.getElementById('progress-fill');
        const difficultyBadge = document.getElementById('difficulty-badge');
        const darkModeToggle = document.getElementById('dark-mode-toggle');
        const cheatsheetToggle = document.getElementById('cheatsheet-toggle');
        const cheatsheet = document.getElementById('cheatsheet');

        // Game State
        let currentQuestionIndex = 0;
        let score = 0;
        let currentQuestion;
        let hintShown = false;
        let darkMode = true;

        // Apply dark mode if saved
        if (darkMode) {
            document.body.classList.add('dark-mode');
        }

        // Questions with difficulty levels
        const questions = [
            {
                description: "Sum all elements of the matrix.",
                difficulty: "easy",
                inputTensors: [
                    { shape: [3, 3], data: [[1, 2, 3], [4, 5, 6], [7, 8, 9]] }
                ],
                outputTensor: { shape: [], data: 45 },
                einsumString: "ij->",
                explanation: "The 'ij->' string means that we are summing over both the i and j indices. This results in a scalar value containing the sum of all elements.",
                hint: "When no indices appear after the arrow, all indices are summed over."
            },
            {
                description: "Compute the trace of the matrix (sum of diagonal elements).",
                difficulty: "easy",
                inputTensors: [
                    { shape: [3, 3], data: [[1, 2, 3], [4, 5, 6], [7, 8, 9]] }
                ],
                outputTensor: { shape: [], data: 15 },
                einsumString: "ii->",
                explanation: "The 'ii->' string means that we are summing over the diagonal elements (where the row and column indices are the same). In this case: 1 + 5 + 9 = 15.",
                hint: "When the same index appears twice in the input, it means we're only considering elements where those dimensions are equal (the diagonal)."
            },
            {
                description: "Multiply a matrix by a vector.",
                difficulty: "medium",
                inputTensors: [
                    { shape: [2, 3], data: [[1, 2, 3], [4, 5, 6]] },
                    { shape: [3], data: [7, 8, 9] }
                ],
                outputTensor: { shape: [2], data: [50, 122] },
                einsumString: "ij,j->i",
                explanation: "The 'ij,j->i' string performs matrix-vector multiplication. The 'j' index appears in both the matrix and vector and is summed over, while the 'i' index remains in the output.",
                hint: "For matrix-vector multiplication, the shared dimension is summed over, and the other dimension remains."
            },
            {
                description: "Compute the dot product of two vectors.",
                difficulty: "easy",
                inputTensors: [
                    { shape: [3], data: [1, 2, 3] },
                    { shape: [3], data: [4, 5, 6] }
                ],
                outputTensor: { shape: [], data: 32 },
                einsumString: "i,i->",
                explanation: "The 'i,i->' string computes the dot product by summing the element-wise products of the two vectors: (1×4) + (2×5) + (3×6) = 4 + 10 + 18 = 32.",
                hint: "The dot product multiplies corresponding elements and sums the results. No indices remain after the arrow."
            },
            {
                description: "Transpose the matrix.",
                difficulty: "easy",
                inputTensors: [
                    { shape: [2, 3], data: [[1, 2, 3], [4, 5, 6]] },
                ],
                outputTensor: { shape: [3, 2], data: [[1, 4], [2, 5], [3, 6]] },
                einsumString: "ij->ji",
                explanation: "The 'ij->ji' string swaps the axes of the matrix, effectively transposing it. The first dimension becomes the second, and vice versa.",
                hint: "To transpose a matrix, simply swap the order of indices after the arrow."
            },
            {
                description: "Perform a batch matrix multiplication.",
                difficulty: "hard",
                inputTensors: [
                    { shape: [2, 2, 3], data: [[[1, 2, 3], [4, 5, 6]], [[7, 8, 9], [10, 11, 12]]] },
                    { shape: [2, 3, 4], data: [[[13, 14, 15, 16], [17, 18, 19, 20], [21, 22, 23, 24]], [[25, 26, 27, 28], [29, 30, 31, 32], [33, 34, 35, 36]]] }
                ],
                outputTensor: { shape: [2, 2, 4], data: [[[118, 124, 130, 136], [280, 298, 316, 334]], [[502, 536, 570, 604], [670, 716, 762, 808]]] },
                einsumString: "ijk,ikl->ijl",
                explanation: "The 'ijk,ikl->ijl' performs matrix multiplication for each batch. The 'k' dimension is summed over, while 'i' (batch), 'j' (row), and 'l' (column) remain in the output.",
                hint: "In batch operations, the batch dimension is preserved. For matrix multiplication, the inner dimensions are contracted (summed over)."
            },
            {
                description: "Compute the outer product of two vectors.",
                difficulty: "medium",
                inputTensors: [
                    { shape: [2], data: [1, 2] },
                    { shape: [3], data: [3, 4, 5] },
                ],
                outputTensor: { shape: [2, 3], data: [[3, 4, 5], [6, 8, 10]] },
                einsumString: "i,j->ij",
                explanation: "The 'i,j->ij' string computes the outer product where each element in the first vector is multiplied by each element in the second vector, creating a matrix.",
                hint: "The outer product creates a new dimension for each input dimension, with no summing."
            },
            {
                description: "Sum across the middle axis (reduction).",
                difficulty: "medium",
                inputTensors: [
                    {
                        shape: [2, 3, 4], data: [
                            [[1, 2, 3, 4], [5, 6, 7, 8], [9, 10, 11, 12]],
                            [[13, 14, 15, 16], [17, 18, 19, 20], [21, 22, 23, 24]]
                        ]
                    }
                ],
                outputTensor: { shape: [2, 4], data: [[15, 18, 21, 24], [51, 54, 57, 60]] },
                einsumString: "ijk->ik",
                explanation: "The 'ijk->ik' string sums the elements along the second axis (j), resulting in a tensor with shape [2, 4]. Each element in the output is the sum of elements along the j axis.",
                hint: "Any index that appears in the input but not in the output is summed over."
            },
            {
                description: "Extract the diagonal elements of a matrix.",
                difficulty: "medium",
                inputTensors: [
                    {
                        shape: [4, 4], data: [
                            [1, 2, 3, 4],
                            [5, 6, 7, 8],
                            [9, 10, 11, 12],
                            [13, 14, 15, 16]
                        ]
                    }
                ],
                outputTensor: { shape: [4], data: [1, 6, 11, 16] },
                einsumString: "ii->i",
                explanation: "The 'ii->i' extracts the elements where the row and column indices are equal (the diagonal). Unlike 'ii->' which sums these elements, 'ii->i' keeps them as a vector.",
                hint: "Using the same index twice in input but once in output extracts diagonal elements without summing them."
            },
            {
                description: "Tensor contraction (generalized matrix multiplication)",
                difficulty: "hard",
                inputTensors: [
                    {
                        shape: [2, 3, 4], data: [
                            [[1, 2, 3, 4], [5, 6, 7, 8], [9, 10, 11, 12]],
                            [[13, 14, 15, 16], [17, 18, 19, 20], [21, 22, 23, 24]]
                        ]
                    },
                    {
                        shape: [4, 3, 2], data: [
                            [[25, 26], [27, 28], [29, 30]],
                            [[31, 32], [33, 34], [35, 36]],
                            [[37, 38], [39, 40], [41, 42]],
                            [[43, 44], [45, 46], [47, 48]]
                        ]
                    }
                ],
                outputTensor: { shape: [2, 2], data: [[3302, 3392], [8878, 9136]] },
                einsumString: "ijk,kjl->il",
                explanation: "The 'ijk,kjl->il' string performs a contraction over the 'j' and 'k' indices, which appear in both tensors. The 'i' and 'l' indices remain in the output.",
                hint: "In tensor contraction, indices that appear in both input tensors are summed over. The remaining indices form the output shape."
            }
        ];

        // Initialize the game
        function initGame() {
            updateScoreDisplay();
            displayQuestion();

            // Event listeners
            nextQuestionButton.addEventListener('click', nextQuestion);
            hintButton.addEventListener('click', toggleHint);
            darkModeToggle.addEventListener('click', toggleDarkMode);
            cheatsheetToggle.addEventListener('click', toggleCheatsheet);

            // Keyboard shortcuts
            document.addEventListener('keydown', (e) => {
                if (e.key === 'Enter' && e.ctrlKey) {
                    const checkAnswerButton = document.getElementById('check-answer');
                    if (checkAnswerButton && !checkAnswerButton.disabled) {
                        checkAnswerButton.click();
                    }
                } else if (e.key === 'ArrowRight' && !nextQuestionButton.disabled) {
                    nextQuestionButton.click();
                } else if (e.key === 'h' && e.ctrlKey) {
                    e.preventDefault();
                    hintButton.click();
                }
            });
        }

        // Display the current question
        function displayQuestion() {
            const question = questions[currentQuestionIndex];
            currentQuestion = question;
            hintShown = false;

            // Update progress indicators
            questionCounter.textContent = `Question ${currentQuestionIndex + 1} of ${questions.length}`;
            progressFill.style.width = `${((currentQuestionIndex) / questions.length) * 100}%`;

            // Set difficulty badge
            difficultyBadge.textContent = question.difficulty.toUpperCase();
            difficultyBadge.className = `difficulty-badge difficulty-${question.difficulty}`;

            // Reset hint
            hintText.classList.remove('show');
            hintText.textContent = question.hint;

            // Generate HTML for input tensors
            let inputTensorHTML = question.inputTensors.map((tensor, index) => {
                let tensorDataHTML = formatTensorData(tensor);

                return `
                    <div class="mb-4">
                        <h3 class="text-lg font-semibold text-gray-700 dark:text-gray-300 mb-2">Input Tensor ${index + 1}</h3>
                        <p class="text-gray-600 dark:text-gray-400 mb-2">Shape: [${tensor.shape.join(', ')}]</p>
                        <div class="tensor-container bg-gray-100 dark:bg-gray-700 p-3 rounded-lg overflow-auto">
                            ${tensorDataHTML}
                        </div>
                    </div>
                `;
            }).join('');

            // Generate HTML for output tensor
            let outputTensorHTML = `
                <div class="mb-4">
                    <h3 class="text-lg font-semibold text-gray-700 dark:text-gray-300 mb-2">Expected Output Tensor</h3>
                    <p class="text-gray-600 dark:text-gray-400 mb-2">Shape: [${question.outputTensor.shape.join(', ')}]</p>
                    <div class="tensor-container bg-gray-100 dark:bg-gray-700 p-3 rounded-lg overflow-auto">
                        ${formatTensorData(question.outputTensor)}
                    </div>
                </div>
            `;

            // Create the question HTML
            const questionHTML = `
                <div class="mb-6">
                    <p class="text-xl text-gray-800 dark:text-gray-200 mb-2">${question.description}</p>
                </div>
                ${inputTensorHTML}
                ${outputTensorHTML}
                <div class="mt-6">
                    <label for="einsum-input" class="block text-gray-700 dark:text-gray-300 text-sm font-bold mb-2">Your Einsum String:</label>
                    <div class="flex">
                        <input type="text" id="einsum-input" placeholder="e.g., ij,jk->ik" 
                            class="flex-grow shadow appearance-none border rounded-l-lg py-2 px-3 text-gray-700 dark:text-gray-200 dark:bg-gray-700 dark:border-gray-600 leading-tight focus:outline-none focus:ring-2 focus:ring-blue-500 monospace">
                        <button id="check-answer" 
                            class="btn bg-blue-600 hover:bg-blue-700 text-white font-medium py-2 px-4 rounded-r-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                            Check Answer
                        </button>
                    </div>
                </div>
            `;

            // Update the game content
            gameContent.innerHTML = questionHTML;
            feedback.innerHTML = '';

            // Add event listener to the check answer button
            const checkAnswerButton = document.getElementById('check-answer');
            const einsumInput = document.getElementById('einsum-input');

            checkAnswerButton.addEventListener('click', checkAnswer);
            einsumInput.addEventListener('keydown', (e) => {
                if (e.key === 'Enter') {
                    checkAnswer();
                }
            });

            // Disable the next question button until the answer is checked
            nextQuestionButton.disabled = true;
            nextQuestionButton.classList.add('opacity-50', 'cursor-not-allowed');
            nextQuestionButton.classList.remove('hover:bg-green-700');
        }

        // Format tensor data for display
        function formatTensorData(tensor) {
            if (tensor.shape.length === 0) {
                // Scalar
                return `<div class="matrix-display">${tensor.data.toFixed(2)}</div>`;
            } else if (tensor.shape.length === 1) {
                // Vector
                return `<div class="tensor-row">
                    ${tensor.data.map(val => `<div class="matrix-display">${val.toFixed(2)}</div>`).join('')}
                </div>`;
            } else if (tensor.shape.length === 2) {
                // Matrix
                return tensor.data.map(row => {
                    return `<div class="tensor-row">
                        ${row.map(val => `<div class="matrix-display">${val.toFixed(2)}</div>`).join('')}
                    </div>`;
                }).join('');
            } else {
                // Higher-dimensional tensor
                return tensor.data.map((matrix, idx) => {
                    return `
                        <div class="mb-2">
                            <div class="text-sm text-gray-500 dark:text-gray-400 mb-1">Batch ${idx + 1}</div>
                            ${matrix.map(row => {
                        return `<div class="tensor-row">
                                    ${row.map(val => `<div class="matrix-display">${val.toFixed(2)}</div>`).join('')}
                                </div>`;
                    }).join('')}
                        </div>
                    `;
                }).join('');
            }
        }

        // Check the user's answer
        async function checkAnswer() {
            const userInput = document.getElementById('einsum-input').value.trim();

            if (!userInput) {
                feedback.innerHTML = `<div class="feedback-message wrong-answer">Please enter an einsum string.</div>`;
                return;
            }

            let isCorrect = false;
            let calculatedOutput;

            try {
                // Convert input tensors to TensorFlow tensors
                const tfInputTensors = currentQuestion.inputTensors.map(tensor => tf.tensor(tensor.data, tensor.shape));

                // Calculate the output using the user's einsum string
                calculatedOutput = tf.einsum(userInput, ...tfInputTensors).arraySync();

                // Compare with the expected output
                isCorrect = compareTensorData(calculatedOutput, currentQuestion.outputTensor.data);

                // Clean up tensors to prevent memory leaks
                tfInputTensors.forEach(tensor => tensor.dispose());
            } catch (error) {
                console.error("TensorFlow.js error:", error);
                feedback.innerHTML = `<div class="feedback-message wrong-answer">
                    <p class="font-semibold">Invalid einsum string</p>
                    <p class="text-sm mt-1">Please check the format (e.g., 'ij,jk->ik'). ${error.message}</p>
                </div>`;

                // Enable the next question button
                nextQuestionButton.disabled = false;
                nextQuestionButton.classList.remove('opacity-50', 'cursor-not-allowed');
                nextQuestionButton.classList.add('hover:bg-green-700');
                return;
            }

            // Generate feedback HTML
            let feedbackHTML = '';

            if (isCorrect) {
                // Correct answer
                feedbackHTML = `
                    <div class="feedback-message correct-answer">
                        <div class="flex items-center">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" />
                            </svg>
                            <p class="font-semibold">Correct!</p>
                        </div>
                    </div>
                    <div class="game-explanation mt-4">
                        <p class="font-medium mb-2">Explanation:</p>
                        <p>${currentQuestion.explanation}</p>
                    </div>
                `;
                score++;
                updateScoreDisplay();
            } else {
                // Wrong answer
                const explanation = getWrongAnswerExplanation(userInput, calculatedOutput, currentQuestion.outputTensor.data, currentQuestion.einsumString);

                feedbackHTML = `
                    <div class="feedback-message wrong-answer">
                        <div class="flex items-center">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
                            </svg>
                            <p class="font-semibold">Incorrect</p>
                        </div>
                        <p class="mt-2">${explanation}</p>
                    </div>
                    <div class="mt-4 p-4 bg-gray-100 dark:bg-gray-700 rounded-lg">
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div>
                                <p class="font-medium text-gray-700 dark:text-gray-300 mb-1">Your einsum string:</p>
                                <code class="monospace bg-white dark:bg-gray-800 px-2 py-1 rounded">${userInput}</code>
                            </div>
                            <div>
                                <p class="font-medium text-gray-700 dark:text-gray-300 mb-1">Correct einsum string:</p>
                                <code class="monospace bg-white dark:bg-gray-800 px-2 py-1 rounded">${currentQuestion.einsumString}</code>
                            </div>
                        </div>
                    </div>
                    <div class="game-explanation mt-4">
                        <p class="font-medium mb-2">Explanation:</p>
                        <p>${currentQuestion.explanation}</p>
                    </div>
                `;
            }

            // Update the feedback
            feedback.innerHTML = feedbackHTML;

            // Enable the next question button
            nextQuestionButton.disabled = false;
            nextQuestionButton.classList.remove('opacity-50', 'cursor-not-allowed');
            nextQuestionButton.classList.add('hover:bg-green-700');

            // Scroll to the feedback
            feedback.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
        }

        // Compare tensor data for equality
        function compareTensorData(calculated, expected) {
            // Handle scalar values
            if (!Array.isArray(calculated) && !Array.isArray(expected)) {
                return Math.abs(calculated - expected) < 1e-6;
            }

            // Handle arrays
            if (Array.isArray(calculated) && Array.isArray(expected)) {
                if (calculated.length !== expected.length) {
                    return false;
                }

                for (let i = 0; i < calculated.length; i++) {
                    if (!compareTensorData(calculated[i], expected[i])) {
                        return false;
                    }
                }

                return true;
            }

            // One is array, one is not
            return false;
        }

        // Move to the next question
        function nextQuestion() {
            currentQuestionIndex++;

            if (currentQuestionIndex < questions.length) {
                // Display the next question
                displayQuestion();

                // Scroll to the top of the game content
                gameContent.scrollIntoView({ behavior: 'smooth', block: 'start' });
            } else {
                // Game over
                showGameOver();
            }
        }

        // Show game over screen
        function showGameOver() {
            // Calculate percentage score
            const percentage = Math.round((score / questions.length) * 100);

            // Determine message based on score
            let message;
            if (percentage >= 90) {
                message = "Excellent! You've mastered einsum notation!";
            } else if (percentage >= 70) {
                message = "Great job! You have a solid understanding of einsum notation.";
            } else if (percentage >= 50) {
                message = "Good effort! Keep practicing to improve your einsum skills.";
            } else {
                message = "Keep learning! Einsum notation takes practice to master.";
            }

            // Create game over HTML
            const gameOverHTML = `
                <div class="text-center py-8">
                    <h2 class="text-2xl font-bold text-gray-800 dark:text-gray-200 mb-4">Game Complete!</h2>
                    <div class="mb-6">
                        <div class="text-5xl font-bold text-blue-600 dark:text-blue-400 mb-2">${percentage}%</div>
                        <p class="text-lg text-gray-600 dark:text-gray-400">Your score: ${score} out of ${questions.length}</p>
                    </div>
                    <p class="text-xl text-gray-700 dark:text-gray-300 mb-8">${message}</p>
                    <button id="restart-game" class="btn bg-blue-600 hover:bg-blue-700 text-white font-medium py-3 px-6 rounded-lg">
                        Play Again
                    </button>
                </div>
            `;

            // Update the game content
            gameContent.innerHTML = gameOverHTML;
            feedback.innerHTML = '';

            // Hide the next question button and hint button
            nextQuestionButton.style.display = 'none';
            hintButton.style.display = 'none';

            // Add event listener to the restart button
            const restartButton = document.getElementById('restart-game');
            restartButton.addEventListener('click', restartGame);
        }

        // Restart the game
        function restartGame() {
            // Reset game state
            currentQuestionIndex = 0;
            score = 0;

            // Show the next question button and hint button
            nextQuestionButton.style.display = 'flex';
            hintButton.style.display = 'flex';

            // Update the score display
            updateScoreDisplay();

            // Display the first question
            displayQuestion();
        }

        // Update the score display
        function updateScoreDisplay() {
            scoreDisplay.textContent = `Score: ${score}/${questions.length}`;
        }

        // Toggle dark mode
        function toggleDarkMode() {
            document.body.classList.toggle('dark-mode');
            darkMode = document.body.classList.contains('dark-mode');
            localStorage.setItem('darkMode', darkMode);

            // Update the dark mode toggle icon
            if (darkMode) {
                darkModeToggle.innerHTML = `
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
                        <path fill-rule="evenodd" d="M10 2a1 1 0 011 1v1a1 1 0 11-2 0V3a1 1 0 011-1zm4 8a4 4 0 11-8 0 4 4 0 018 0zm-.464 4.95l.707.707a1 1 0 001.414-1.414l-.707-.707a1 1 0 00-1.414 1.414zm2.12-10.607a1 1 0 010 1.414l-.706.707a1 1 0 11-1.414-1.414l.707-.707a1 1 0 011.414 0zM17 11a1 1 0 100-2h-1a1 1 0 100 2h1zm-7 4a1 1 0 011 1v1a1 1 0 11-2 0v-1a1 1 0 011-1zM5.05 6.464A1 1 0 106.465 5.05l-.708-.707a1 1 0 00-1.414 1.414l.707.707zm1.414 8.486l-.707.707a1 1 0 01-1.414-1.414l.707-.707a1 1 0 011.414 1.414zM4 11a1 1 0 100-2H3a1 1 0 000 2h1z" clip-rule="evenodd" />
                    </svg>
                `;
            } else {
                darkModeToggle.innerHTML = `
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
                        <path d="M17.293 13.293A8 8 0 016.707 2.707a8.001 8.001 0 1010.586 10.586z" />
                    </svg>
                `;
            }
        }

        // Toggle cheatsheet
        function toggleCheatsheet() {
            cheatsheet.classList.toggle('show');
        }

        // Get explanation for wrong answers
        function getWrongAnswerExplanation(userInput, calculatedOutput, expectedOutput, expectedEinsum) {
            // Basic validation
            if (!userInput) {
                return "Please provide an einsum string.";
            }

            try {
                // Check einsum string format
                const parts = userInput.split('->');
                if (parts.length !== 2) {
                    return "Invalid einsum string format. It should be in the form 'input_indices->output_indices'.";
                }

                const inputIndices = parts[0].split(',');
                const outputIndices = parts[1];

                // Check number of input tensors
                if (inputIndices.length !== currentQuestion.inputTensors.length) {
                    return `The number of input tensors in your einsum string (${inputIndices.length}) does not match the number of input tensors provided (${currentQuestion.inputTensors.length}).`;
                }

                // Check for invalid characters
                const validChars = 'abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ';
                if (!inputIndices.every(s => [...s].every(c => validChars.includes(c))) ||
                    ![...outputIndices].every(c => validChars.includes(c))) {
                    return "Invalid characters in einsum string. Use only letters (a-zA-Z).";
                }

                // Check output shape
                if (calculatedOutput) {
                    const calculatedShape = getShape(calculatedOutput);
                    const expectedShape = currentQuestion.outputTensor.shape;

                    if (calculatedShape.length !== expectedShape.length) {
                        return `Output tensor has incorrect number of dimensions. Expected ${expectedShape.length}, got ${calculatedShape.length}.`;
                    }

                    // Check if shapes match
                    for (let i = 0; i < calculatedShape.length; i++) {
                        if (calculatedShape[i] !== expectedShape[i]) {
                            return `Output tensor has incorrect shape. Expected [${expectedShape.join(', ')}], got [${calculatedShape.join(', ')}].`;
                        }
                    }

                    // If shapes match but values don't
                    return "Your einsum string produces a tensor with the correct shape, but the values are incorrect. Check your understanding of which indices are being summed over.";
                }

                // If the einsum string is correct but calculation failed
                if (userInput === expectedEinsum) {
                    return "Your einsum string is correct, but there was an error in the calculation.";
                }

                return "The einsum string does not produce the correct result. Please review the einsum operation and try again.";
            } catch (e) {
                return "An error occurred while processing your einsum string. Please check the format and try again.";
            }
        }

        // Get shape of an array (recursively)
        function getShape(arr) {
            if (!Array.isArray(arr)) {
                return [];
            }

            const shape = [arr.length];

            if (arr.length > 0) {
                const firstElement = arr[0];
                if (Array.isArray(firstElement)) {
                    const restShape = getShape(firstElement);
                    shape.push(...restShape);
                }
            }

            return shape;
        }

        // Generate better hints for each question
        function generateDetailedHint(question) {
            // Base hint from the question
            const baseHint = question.hint;

            // Additional detailed hints based on the question type
            let detailedHint = '';

            if (question.einsumString.includes('->')) {
                const parts = question.einsumString.split('->');
                const inputPart = parts[0];
                const outputPart = parts[1];

                // Analyze the pattern
                if (inputPart.includes(',')) {
                    // Multiple input tensors
                    detailedHint += "This operation involves multiple tensors. Think about which dimensions should align and which should be summed over. ";
                }

                if (inputPart.includes('i') && inputPart.includes('j')) {
                    // Likely a matrix operation
                    detailedHint += "Remember that 'i' typically represents rows and 'j' typically represents columns in matrix notation. ";
                }

                if (inputPart.match(/([a-z])\1/)) {
                    // Repeated indices in input
                    detailedHint += "When the same index appears twice in an input, it often refers to diagonal elements. ";
                }

                if (outputPart === '') {
                    // Reduction to scalar
                    detailedHint += "When the output has no indices, all dimensions are summed over, producing a scalar. ";
                }
            }

            return `<p class="hint-primary">${baseHint}</p>
                <p class="hint-secondary mt-2">${detailedHint}</p>
                <p class="hint-example mt-2">Format example: For matrix multiplication, use "ij,jk->ik"</p>`;
        }

        // Enhanced hint toggle function
        function toggleHint() {
            hintText.classList.toggle('show');

            // Generate an enhanced hint
            if (hintText.classList.contains('show') && !hintShown) {
                hintText.innerHTML = generateDetailedHint(currentQuestion);

                hintButton.innerHTML = `
                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2" viewBox="0 0 20 20" fill="currentColor">
                    <path fill-rule="evenodd" d="M5 10a1 1 0 011-1h8a1 1 0 110 2H6a1 1 0 01-1-1z" clip-rule="evenodd" />
                </svg>
                Hide Hint
            `;
                hintShown = true;
            } else if (!hintText.classList.contains('show')) {
                hintButton.innerHTML = `
                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2" viewBox="0 0 20 20" fill="currentColor">
                    <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2h-1V9a1 1 0 00-1-1z" clip-rule="evenodd" />
                </svg>
                Show Hint
            `;
                hintShown = false;
            }
        }

        // Improved tensor data formatting for readability
        function formatTensorData(tensor) {
            if (tensor.shape.length === 0) {
                // Scalar
                return `<div class="matrix-display">${Number(tensor.data).toFixed(2)}</div>`;
            } else if (tensor.shape.length === 1) {
                // Vector
                return `<div class="tensor-row">
                ${tensor.data.map(val => `<div class="matrix-display">${Number(val).toFixed(2)}</div>`).join('')}
            </div>`;
            } else if (tensor.shape.length === 2) {
                // Matrix
                return `<div class="matrix-container">
                ${tensor.data.map(row => {
                    return `<div class="tensor-row">
                        ${row.map(val => `<div class="matrix-display">${Number(val).toFixed(2)}</div>`).join('')}
                    </div>`;
                }).join('')}
            </div>`;
            } else {
                // Higher-dimensional tensor
                return `<div class="tensor-3d-container">
                ${tensor.data.map((matrix, idx) => {
                    return `
                        <div class="tensor-slice mb-3">
                            <div class="text-sm font-medium text-gray-500 dark:text-gray-400 mb-1">Slice ${idx + 1}</div>
                            <div class="matrix-container bg-white dark:bg-gray-750 p-2 rounded-lg">
                                ${matrix.map(row => {
                        return `<div class="tensor-row">
                                        ${row.map(val => `<div class="matrix-display">${Number(val).toFixed(2)}</div>`).join('')}
                                    </div>`;
                    }).join('')}
                            </div>
                        </div>
                    `;
                }).join('')}
            </div>`;
            }
        }

        // Add CSS for enhanced hint styling
        const styleElement = document.createElement('style');
        styleElement.textContent = `
        .hint-primary {
            font-weight: 500;
            color: #d97706;
        }
        
        .hint-secondary {
            color: #78350f;
            font-size: 0.9rem;
        }
        
        .hint-example {
            background-color: #fffbeb;
            padding: 0.5rem;
            border-radius: 0.25rem;
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.85rem;
            color: #92400e;
        }
        
        .dark-mode .hint-example {
            background-color: #78350f;
            color: #fef3c7;
        }
        
        .dark-mode .hint-primary {
            color: #fbbf24;
        }
        
        .dark-mode .hint-secondary {
            color: #fde68a;
        }
        
        .matrix-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            border: 1px solid #e5e7eb;
            border-radius: 0.5rem;
            padding: 0.75rem;
            background-color: rgba(255, 255, 255, 0.5);
        }
        
        .dark-mode .matrix-container {
            border-color: #4b5563;
            background-color: rgba(31, 41, 55, 0.5);
        }
        
        .tensor-3d-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            gap: 1rem;
        }
        
        @media (max-width: 640px) {
            .tensor-3d-container {
                grid-template-columns: 1fr;
            }
        }
    `;

        document.head.appendChild(styleElement);

        // Create a new interactive tutorial component
        function createTutorial() {
            const tutorialHTML = `
            <div id="tutorial-modal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden">
                <div class="bg-white dark:bg-gray-800 rounded-xl shadow-xl p-6 max-w-2xl max-h-[90vh] overflow-y-auto">
                    <div class="flex justify-between items-center mb-4">
                        <h2 class="text-xl font-bold text-gray-800 dark:text-gray-200">Einsum Notation Tutorial</h2>
                        <button id="close-tutorial" class="text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
                            </svg>
                        </button>
                    </div>
                    
                    <div class="space-y-4">
                        <div>
                            <h3 class="font-medium text-gray-800 dark:text-gray-200 mb-2">What is Einstein Summation?</h3>
                            <p class="text-gray-600 dark:text-gray-400">
                                Einstein Summation Notation (einsum) is a concise way to express operations on multi-dimensional arrays. 
                                It's named after Albert Einstein, who introduced a similar notation for tensor operations in physics.
                            </p>
                        </div>
                        
                        <div>
                            <h3 class="font-medium text-gray-800 dark:text-gray-200 mb-2">Basic Format</h3>
                            <p class="text-gray-600 dark:text-gray-400">
                                The general format is: <code class="monospace bg-gray-100 dark:bg-gray-700 px-2 py-1 rounded">input_indices->output_indices</code>
                            </p>
                            <ul class="list-disc list-inside mt-2 space-y-1 text-gray-600 dark:text-gray-400">
                                <li>Each input tensor gets a set of indices (e.g., "ij" for a matrix)</li>
                                <li>Multiple input tensors are separated by commas</li>
                                <li>The arrow "->" points to the output indices</li>
                                <li>Repeated indices are summed over</li>
                            </ul>
                        </div>
                        
                        <div class="p-3 bg-blue-50 dark:bg-blue-900/30 rounded-lg">
                            <h3 class="font-medium text-blue-800 dark:text-blue-200 mb-2">Examples with Visualizations</h3>
                            <div class="space-y-3">
                                <div>
                                    <p class="text-blue-700 dark:text-blue-300 mb-1">Matrix Multiplication: <code class="monospace bg-white dark:bg-gray-800 px-2 py-1 rounded">ij,jk->ik</code></p>
                                    <p class="text-sm text-blue-600 dark:text-blue-400">
                                        Here 'j' is the shared index that gets summed over, while 'i' and 'k' remain in the output.
                                    </p>
                                </div>
                                
                                <div>
                                    <p class="text-blue-700 dark:text-blue-300 mb-1">Transpose: <code class="monospace bg-white dark:bg-gray-800 px-2 py-1 rounded">ij->ji</code></p>
                                    <p class="text-sm text-blue-600 dark:text-blue-400">
                                        Swapping the indices in the output changes the order of dimensions.
                                    </p>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <button id="start-practice" class="mt-6 bg-blue-600 hover:bg-blue-700 text-white font-medium py-2 px-4 rounded-lg w-full">
                        Start Practicing
                    </button>
                </div>
            </div>
        `;

            // Add to the document
            const tutorialContainer = document.createElement('div');
            tutorialContainer.innerHTML = tutorialHTML;
            document.body.appendChild(tutorialContainer);

            // Add tutorial button to header
            const headerDiv = document.querySelector('header > div:last-child');
            const tutorialButton = document.createElement('button');
            tutorialButton.id = 'tutorial-button';
            tutorialButton.className = 'flex items-center bg-green-100 dark:bg-green-900 text-green-800 dark:text-green-200 px-4 py-2 rounded-lg font-medium mr-4';
            tutorialButton.innerHTML = `
            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2" viewBox="0 0 20 20" fill="currentColor">
                <path d="M10.394 2.08a1 1 0 00-.788 0l-7 3a1 1 0 000 1.84L5.25 8.051a.999.999 0 01.356-.257l4-1.714a1 1 0 11.788 1.838L7.667 9.088l1.94.831a1 1 0 00.787 0l7-3a1 1 0 000-1.838l-7-3zM3.31 9.397L5 10.12v4.102a8.969 8.969 0 00-1.05-.174 1 1 0 01-.89-.89 11.115 11.115 0 01.25-3.762zM9.3 16.573A9.026 9.026 0 007 14.935v-3.957l1.818.78a3 3 0 002.364 0l5.508-2.361a11.026 11.026 0 01.25 3.762 1 1 0 01-.89.89 8.968 8.968 0 00-5.35 2.524 1 1 0 01-1.4 0zM6 18a1 1 0 001-1v-2.065a8.935 8.935 0 00-2-.712V17a1 1 0 001 1z" />
            </svg>
            Tutorial
        `;
            headerDiv.insertBefore(tutorialButton, headerDiv.firstChild);

            // Event listeners
            document.getElementById('tutorial-button').addEventListener('click', () => {
                document.getElementById('tutorial-modal').classList.remove('hidden');
            });

            document.getElementById('close-tutorial').addEventListener('click', () => {
                document.getElementById('tutorial-modal').classList.add('hidden');
            });

            document.getElementById('start-practice').addEventListener('click', () => {
                document.getElementById('tutorial-modal').classList.add('hidden');
            });
        }

        // Initialize the tutorial
        function initTutorial() {
            createTutorial();
        }

        // Initialize the game and tutorial when the page loads
        window.addEventListener('DOMContentLoaded', () => {
            initGame();
            initTutorial();
        });
    </script>
</body>

</html>